<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin the Wheel</title>
    <style>
        /* Wheel styles */
        #wheelContainer {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
        }
        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            transition: transform 5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            text-align: center;
            line-height: 150px;
            font-size: 20px;
            font-weight: bold;
            color: white;
        }
        #spinBtn {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 80px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            font-size: 16px;
            z-index: 10;
        }
        /* Email input styles */
        #emailInput {
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            z-index: 11;
        }
        #emailInput:focus {
            outline: none;
            border-color: #4CAF50;
        }
        #submitEmailBtn {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 8px 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 12;
        }
        #result {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>

<div id="wheelContainer">
    <div id="wheel">
        <!-- Segments will be added here by JavaScript -->
    </div>
    <input type="email" id="emailInput" placeholder="Enter your email">
    <button id="submitEmailBtn">Submit Email</button>
    <button id="spinBtn" disabled>Spin</button>
</div>

<div id="result"></div>

<script>
    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const emailInput = document.getElementById('emailInput');
    const submitEmailBtn = document.getElementById('submitEmailBtn');
    const resultDiv = document.getElementById('result');

    let spinning = false;

    const prizes = [
        { name: 'Free Sticker', weight: 50 },
        { name: 'BOGO 25% Off', weight: 10 },
        { name: '$5 Off', weight: 10 },
        { name: '8.8% Off', weight: 10 },
        { name: 'Free Shipping', weight: 10 },
    ];

    const segments = prizes.map(prize => prize.name);

    const colors = ['#E74C3C', '#3498DB', '#F39C12', '#9B59B6', '#2ECC71'];

    let segmentsCreated = false; // Flag to track if segments are created

    function createSegments() {
        if (segmentsCreated) return; // Prevent creating segments multiple times
        const numSegments = segments.length;
        const segmentAngle = 360 / numSegments;
        let rotation = 0;

        for (let i = 0; i < numSegments; i++) {
            const segment = document.createElement('div');
            segment.className = 'segment';
            segment.style.backgroundColor = colors[i % colors.length];
            segment.style.transform = `rotate(${rotation}deg)`;
            segment.style.webkitTransform = `rotate(${rotation}deg)`; // For Safari
            segment.innerHTML = segments[i];
            wheel.appendChild(segment);
            rotation += segmentAngle;
        }
        segmentsCreated = true;
    }

    function spinWheel() {
        if (spinning) return;
        spinning = true;

        const email = emailInput.value;
        if (!validateEmail(email)) {
            alert('Please enter a valid email address.');
            spinning = false;
            return;
        }

        // Disable email input and submit button after spinning
        emailInput.disabled = true;
        submitEmailBtn.disabled = true;

        // Assign weights to each prize
        const weightedPrizes = prizes.reduce((arr, prize, index) => {
            for (let i = 0; i < prize.weight; i++) {
                arr.push(index);
            }
            return arr;
        }, []);

        // Randomly select a prize
        const winningIndex = weightedPrizes[Math.floor(Math.random() * weightedPrizes.length)];
        const winningSegment = segments[winningIndex];

        // Calculate rotation
        const rand = Math.floor(Math.random() * 360);
        const rotation = 360 * 5 + rand + (360 - (winningIndex * (360 / segments.length) + (360 / segments.length) / 2));

        wheel.style.transform = `rotate(${rotation}deg)`;

        wheel.addEventListener('transitionend', () => {
            resultDiv.innerHTML = `Congratulations! You won: ${winningSegment}`;
            spinning = false;
            // Optionally, send data to Google Sheets here
        }, { once: true });
    }

    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }

    submitEmailBtn.addEventListener('click', function() {
        const email = emailInput.value;
        if (validateEmail(email)) {
            spinBtn.disabled = false;
            submitEmailBtn.style.display = 'none'; // Hide the submit button
            emailInput.style.display = 'none'; // Hide the email input
            createSegments(); // Create the segments when the email is submitted
            alert('Email submitted! You can now spin the wheel.');
        } else {
            alert('Please enter a valid email address.');
        }
    });

    spinBtn.addEventListener('click', spinWheel);
</script>

</body>
</html>
